<odoo>
    <record id="action_report_merge_price22" model="ir.actions.report">
        <field name="name">SO Print With Merged Sections</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">yama_so_reports22.report_merge_price_template22</field>
        <field name="report_file">yama_so_reports22.report_merge_price_template22</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="print_report_name">'Print - %s' % (object.name)</field>
    </record>

    <template id="report_merge_price_template22">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="o">
                    <div class="header">
                        <div class="row">
                            <div class="col-12">
                                <img src="/custom_sales_report/static/src/img/Yama_logo.jpg" alt="Company Logo"
                                     style="height: 100px;margin: 10px 0 10px;"/>
                            </div>
                        </div>
                    </div>

                    <div class="page">
                        <div style="page-break-after: always;">
                            <div class="row" style="padding-top:10px">
                                <center>
                                    <h4>Order Number:
                                        <span t-field="o.name"/>
                                    </h4>
                                </center>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <strong>
                                        <p style="color:red;">Date:
                                            <span t-field="o.date_order"/>
                                        </p>
                                        <p style="color:red;">To:</p>
                                        <p>Co.
                                            <span t-field="o.partner_id.display_name"/>
                                        </p>
                                        <p>Eng.
                                            <span t-field="o.partner_id.name"/>
                                        </p>
                                        <p>Tel.
                                            <span t-esc="o.partner_id.mobile or ''"/>
                                        </p>
                                        <p>E-Mail
                                            <span t-esc="o.partner_id.email or ''"/>
                                        </p>
                                    </strong>
                                </div>
                                <div class="col-6" style="text-align: left;padding-top:40px">
                                    <strong>
                                        <p style="color:red;">From:</p>
                                        <p>Co.
                                            <span t-field="o.company_id.name"/>
                                        </p>
                                        <p>Eng.
                                            <span t-field="o.user_id.name"/>
                                        </p>
                                        <p>Tel.
                                            <span t-esc="o.user_id.mobile or ''"/>
                                        </p>
                                        <p>E-Mail
                                            <span t-field="o.user_id.login"/>
                                        </p>
                                    </strong>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12" style="color:red;">
                                    <strong>
                                        <h3>Project:</h3>
                                    </strong>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4"></div>
                                <div class="col-4" style="font-size:18px;">
                                    <strong>
                                        <span t-esc="o.project or ''"/>
                                    </strong>
                                </div>
                                <div class="col-4"></div>
                            </div>
                            <div class="row">
                                <strong>
                                    <div class="col-12" style="color:red;">Sub.:</div>
                                </strong>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <p>Dear Sir,
                                        <br/>
                                        We thank you for giving us the opportunity and are pleased to quote for the
                                        above
                                        Project.
                                        Kindly find our offer as per the following below.
                                        <br/>
                                        We hope our offer is in line with your requirements; looking forward to
                                        contacting
                                        you in the near future to discuss the project further.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div style="page-break-after: always;">
                            <div class="row" style="padding-top:10px">
                                <div class="col-12">
                                    <table class="table table-bordered o_table" style="border:1px solid black">

                                        <thead>
                                            <tr style="text-align:center;font-size:14px;background:gray;font-weight:600">
                                                <th style="width:5%;">Item</th>
                                                <th style="width:72%;">Description</th>
                                                <th style="width:5%;">Brand</th>
                                                <th style="width:5%;">Approval</th>
                                                <th style="width:6%;">Data Sheet</th>
                                                <th style="width:5%;">Quantity</th>
                                                <th style="width:8%;">Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Initialize variables -->
                                            <t t-set="section_counter" t-value="0"/>
                                            <t t-set="product_counter" t-value="0"/>
                                            <t t-set="section_total" t-value="0.0"/>
                                            <t t-set="current_section" t-value="False"/>

                                            <t t-foreach="o.order_line.sorted(key=lambda l: l.sequence)"
                                               t-as="line">
                                                <!-- لو الخط سكشن جديد -->
                                                <t t-if="line.display_type == 'line_section'">
                                                    <!-- اطبع Subtotal للسكشن السابق -->
                                                    <t t-if="current_section and section_total != 0.0">
                                                        <tr style="background-color:#f0f0f0">
                                                            <td colspan="6"
                                                                style="font-weight: bold;font-size: 18px;text-align:right;">
                                                                <strong>Subtotal</strong>
                                                            </td>
                                                            <td>
                                                                <span t-esc="section_total"
                                                                      style="font-weight: bold;font-size: 18px;text-align:center;"
                                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                            </td>
                                                        </tr>
                                                    </t>

                                                    <!-- سكشن جديد -->
                                                    <t t-set="section_counter" t-value="section_counter + 1"/>
                                                    <t t-set="product_counter" t-value="0"/>
                                                    <t t-set="section_total" t-value="0.0"/>
                                                    <t t-set="current_section" t-value="True"/>
                                                    <tr class="o_main_header">
                                                        <td style="text-align:left;font-weight:bold">
                                                            <span t-esc="section_counter"/>
                                                        </td>
                                                        <td colspan="6">
                                                            <strong t-esc="line.name or ''"/>
                                                        </td>
                                                    </tr>
                                                </t>
                                                <!-- لو الخط عادي -->
                                                <t t-if="not line.display_type">
                                                    <t t-set="product_counter" t-value="product_counter + 1"/>
                                                    <tr style="font-size:11px">
                                                        <td style="text-align:right">
                                                            <span t-esc="'%s.%s' % (section_counter, product_counter) if section_counter > 0 else product_counter"/>
                                                        </td>
                                                        <td>
                                                            <!--                                                            <span t-esc="line.product_id.name or line.name"/>-->
                                                            <t t-if="line.x_studio_description_2">
                                                                <span t-esc="line.x_studio_description_2"/>
                                                            </t>
                                                            <t t-else="">
                                                                <span t-esc="line.name or ''"/>
                                                            </t>
                                                        </td>
                                                        <td style="text-align:center;">
                                                            <span t-esc="line.product_id.x_studio_brand_2 or ''"/>
                                                        </td>
                                                        <td style="text-align:center;">
                                                            <span t-esc="line.product_id.x_studio_approval_1 or ''"/>
                                                        </td>
                                                        <td style="max-width:150px;text-align:center;">
                                                            <t t-if="line.product_id">
                                                                <!-- جلب كل المرفقات PDF للمنتج أو الـ template -->
                                                                <t t-set="attachments"
                                                                   t-value="env['ir.attachment'].sudo().search([
                                                                           ('res_model', 'in', ['product.template','product.product']),
                                                                           ('res_id', 'in', [line.product_id.id, line.product_id.product_tmpl_id.id]),
                                                                           ('mimetype', '=', 'application/pdf')
                                                                       ])"/>
                                                                <!-- عرض كل PDF كرابط -->
                                                                <t t-if="attachments">
                                                                    <t t-set="line_index" t-value="0"/>
                                                                    <t t-foreach="attachments" t-as="att">
                                                                        <div>
                                                                            <a t-att-href="'/web/content/%s' % att.id"
                                                                               target="_blank">
                                                                                PDF-
                                                                                <t t-set="line_index"
                                                                                   t-value="line_index+1"/>
                                                                                <t t-esc="line_index"/>
                                                                            </a>
                                                                        </div>
                                                                    </t>
                                                                </t>
                                                            </t>
                                                        </td>
                                                        <td style="text-align:center;">
                                                            <span t-esc="line.product_uom_qty"/>
                                                            <span t-esc="line.product_uom.name"/>
                                                        </td>
                                                        <td style="text-align:center;">
                                                            <t t-if="not line.is_subtotal_merge">
                                                                <span t-esc="line.price_subtotal or 0.0"
                                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                            </t>
                                                            <t t-else="">
                                                                <span/>
                                                            </t>
                                                        </td>

                                                    </tr>
                                                    <t t-if="line.is_subtotal_merge">
                                                        <t t-set="section_total"
                                                           t-value="section_total + (line.price_subtotal or 0.0)"/>
                                                    </t>
                                                </t>

                                                <!-- لو الخط Note -->
                                                <t t-if="line.display_type == 'line_note'">
                                                    <tr>
                                                        <td></td>
                                                        <td colspan="5">
                                                            <i t-esc="line.name or ''"/>
                                                        </td>
                                                    </tr>
                                                </t>

                                            </t>
                                            <!-- اطبع Subtotal للسكشن الأخير -->
                                            <t t-if="current_section and section_total != 0.0">
                                                <tr style="background-color:#f0f0f0">
                                                    <td colspan="6"
                                                        style="font-weight: bold;font-size: 18px;text-align:right;">
                                                        <strong>Subtotal</strong>
                                                    </td>
                                                    <td>
                                                        <span t-esc="section_total"
                                                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row" style="margin-top:10px;">
                                <div class="col-6"></div>
                                <div class="col-6">
                                    <table class="table">
                                        <tr>
                                            <td style="text-align:left;">Untaxed Amount</td>
                                            <td style="text-align:right;">
                                                <span t-esc="o.amount_untaxed or 0.0"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left;">Taxes</td>
                                            <td style="text-align:right;">
                                                <span t-esc="o.amount_tax or 0.0"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </td>
                                        </tr>
                                        <tr style="color:white;background-color:black;">
                                            <td style="text-align:left;">Total</td>
                                            <td style="text-align:right;">
                                                <span t-esc="o.amount_total or 0.0"
                                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <br/>
                        <div>
                            <!--New  Start [Options]  by Eng.Ramah and Eng.Elnayed -->
                            <div class="row" style="margin-top:-39px;">
                                <div class="col-12" style="margin-top:20px;color:red;">
                                    <t t-if="o.sale_order_option_ids">
                                        <strong>Options</strong>
                                        <table class="table table-sm o_main_table table-bordered">
                                            <thead style="border-width: 2px !important;background:gray;">
                                                <tr style="font-size:14px;font-weight:600; text-align: center;">
                                                    <th>Item</th>
                                                    <th style="width:85%;">Description</th>
                                                    <th style="width:10%;">Unit Price</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-set="line_index" t-value="0"/>
                                                <t t-foreach="o.sale_order_option_ids" t-as="option">
                                                    <tr style="border-width: 2px;">
                                                        <td style="text-align: center;">
                                                            <t t-set="line_index" t-value="line_index + 1"/>
                                                            <t t-esc="line_index"/>
                                                        </td>
                                                        <td>
                                                            <t t-esc="option.name"/>
                                                        </td>
                                                        <td style="text-align: center;">
                                                            <span t-esc="option.price_unit"
                                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </t>
                                </div>
                            </div>
                            <!--End [Options] by Eng.Ramah and Eng.Elnayed -->
                            <br/>

                            <!--Start Terms & Conditions -->
                            <div class="row">
                                <div class="col-12" style="margin-top:20px;color:red;">
                                    <strong>
                                        <p>Terms &amp; Conditions</p>
                                    </strong>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div style="padding-left:30px;">
                                        <t t-if="o.warranty">
                                            <div>
                                                <span>Warranty:</span>
                                                <span>
                                                    <t t-esc="o.warranty"/>
                                                </span>
                                                <span>year against production deficiencies.</span>
                                            </div>
                                        </t>
                                        <t t-if="o.drop_down">
                                            <div>
                                                <span>Payment:</span>
                                                <span>
                                                    <t t-esc="o.drop_down"/>
                                                </span>
                                                % Down payment,
                                                <span>
                                                    <t t-esc="o.a100_drp_down"/>
                                                </span>
                                                % with material
                                            </div>
                                        </t>
                                        <span t-esc="o.note or ''"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div style="float:right;">
                                <p>Best Regards,<br/>YAMA Egypt
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="footer" style="border-top: 2px solid red;padding-top: 10px;">
                        <div class="row">
                            <div class="col-12" style="margin-bottom: 9px;">
                                <!-- <img src="/custom_sales_report/static/src/img/footer.jpeg" alt="Company Logo"-->
                                <!-- style="width:100%; height:130px;"/>-->
                                <div style="text-align: center;">
                                    <i class="fa fa-phone" style="color: red;"/>
                                    +201092141946 / 0226707404 / 0222730334

                                    <a target="_blank" href="https://www.yama-es.com/" style="padding: 0 16px;">
                                        <i class="fa fa-envelope" style="color: red;"/>
                                        www.yama-es.com
                                    </a>
                                    <a target="_blank" href="https://www.yama-es.com/ar/about-us">
                                        <i class="fa fa-globe" style="color: red;"></i>
                                        info@yama-es.com
                                    </a>
                                </div>
                                <div style="text-align: center;margin: 6px 0;">
                                    <a target="_blank" href="https://maps.app.goo.gl/yUteZT4WfRxNdt7v7">
                                        <i class="fa fa-map-marker" style="color: red;"></i>
                                        El Serag Mail-Gate 3-Tower 2-3 floor,Nasr city,Cairo,Egypt
                                    </a>

                                </div>

                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
